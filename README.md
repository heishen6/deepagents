# ğŸ§ ğŸ¤–Deep Agents

ä½¿ç”¨ LLM åœ¨å¾ªç¯ä¸­è°ƒç”¨å·¥å…·æ˜¯ä»£ç†æœ€ç®€å•çš„å½¢å¼ã€‚
ç„¶è€Œï¼Œè¿™ç§æ¶æ„å¯èƒ½ä¼šäº§ç”Ÿ"æµ…å±‚"ä»£ç†ï¼Œæ— æ³•è§„åˆ’å’Œæ‰§è¡Œæ›´é•¿æœŸã€æ›´å¤æ‚çš„ä»»åŠ¡ã€‚
åƒ "Deep Research"ã€"Manus" å’Œ "Claude Code" è¿™æ ·çš„åº”ç”¨é€šè¿‡å®ç°å››ä¸ªè¦ç´ çš„ç»„åˆæ¥å…‹æœè¿™ä¸ªé™åˆ¶ï¼š
**è§„åˆ’å·¥å…·**ã€**å­ä»£ç†**ã€**æ–‡ä»¶ç³»ç»Ÿè®¿é—®**å’Œ**è¯¦ç»†çš„æç¤º**ã€‚

<img src="deep_agents.png" alt="deep agent" width="600"/>

`deepagents` æ˜¯ä¸€ä¸ª Python åŒ…ï¼Œå®ƒä»¥é€šç”¨çš„æ–¹å¼å®ç°äº†è¿™äº›åŠŸèƒ½ï¼Œè®©æ‚¨å¯ä»¥è½»æ¾åœ°ä¸ºæ‚¨çš„åº”ç”¨åˆ›å»ºæ·±åº¦ä»£ç†ã€‚

**è‡´è°¢ï¼šè¿™ä¸ªé¡¹ç›®ä¸»è¦å—åˆ° Claude Code çš„å¯å‘ï¼Œæœ€åˆä¸»è¦æ˜¯å°è¯•äº†è§£ä»€ä¹ˆè®© Claude Code å…·æœ‰é€šç”¨æ€§ï¼Œå¹¶ä½¿å…¶æ›´åŠ é€šç”¨ã€‚**

## å®‰è£…

```bash
pip install deepagents
```

## ä½¿ç”¨æ–¹æ³•

ï¼ˆè¦è¿è¡Œä¸‹é¢çš„ç¤ºä¾‹ï¼Œéœ€è¦å…ˆ `pip install tavily-python`ï¼‰

```python
import os
from typing import Literal

from tavily import TavilyClient
from deepagents import create_deep_agent


# ç”¨äºç ”ç©¶çš„æœç´¢å·¥å…·
def internet_search(
    query: str,
    max_results: int = 5,
    topic: Literal["general", "news", "finance"] = "general",
    include_raw_content: bool = False,
):
    """è¿è¡Œç½‘ç»œæœç´¢"""
    tavily_async_client = TavilyClient(api_key=os.environ["TAVILY_API_KEY"])
    return tavily_async_client.search(
        query,
        max_results=max_results,
        include_raw_content=include_raw_content,
        topic=topic,
    )


# å¼•å¯¼ä»£ç†æˆä¸ºä¸“ä¸šç ”ç©¶å‘˜çš„æç¤ºå‰ç¼€
research_instructions = """æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šç ”ç©¶å‘˜ã€‚æ‚¨çš„å·¥ä½œæ˜¯è¿›è¡Œæ·±å…¥ç ”ç©¶ï¼Œç„¶åæ’°å†™ç²¾ç¾çš„æŠ¥å‘Šã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ä¸€äº›å·¥å…·ã€‚

## `internet_search`

ä½¿ç”¨è¿™ä¸ªå·¥å…·ä¸ºç»™å®šçš„æŸ¥è¯¢è¿è¡Œäº’è”ç½‘æœç´¢ã€‚æ‚¨å¯ä»¥æŒ‡å®šç»“æœæ•°é‡ã€ä¸»é¢˜ä»¥åŠæ˜¯å¦åº”åŒ…å«åŸå§‹å†…å®¹ã€‚
"""

# åˆ›å»ºä»£ç†
agent = create_deep_agent(
    [internet_search],
    research_instructions,
)

# è°ƒç”¨ä»£ç†
result = agent.invoke({"messages": [{"role": "user", "content": "ä»€ä¹ˆæ˜¯ langgraphï¼Ÿ"}]})
```

æŸ¥çœ‹ [examples/research/research_agent.py](examples/research/research_agent.py) è·å–æ›´å¤æ‚çš„ç¤ºä¾‹ã€‚

ä½¿ç”¨ `create_deep_agent` åˆ›å»ºçš„ä»£ç†åªæ˜¯ä¸€ä¸ª LangGraph å›¾ - å› æ­¤æ‚¨å¯ä»¥åƒä¸ä»»ä½• LangGraph ä»£ç†ä¸€æ ·ä¸å…¶äº¤äº’ï¼ˆæµå¼ä¼ è¾“ã€äººæœºåä½œã€è®°å¿†ã€studioï¼‰ã€‚

## åˆ›å»ºè‡ªå®šä¹‰æ·±åº¦ä»£ç†

æ‚¨å¯ä»¥å‘ `create_deep_agent` ä¼ é€’ä¸‰ä¸ªå‚æ•°æ¥åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰æ·±åº¦ä»£ç†ã€‚

### `tools`ï¼ˆå¿…éœ€ï¼‰

`create_deep_agent` çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ `tools`ã€‚
è¿™åº”è¯¥æ˜¯å‡½æ•°æˆ– LangChain `@tool` å¯¹è±¡çš„åˆ—è¡¨ã€‚
ä»£ç†ï¼ˆå’Œä»»ä½•å­ä»£ç†ï¼‰å°†å¯ä»¥è®¿é—®è¿™äº›å·¥å…·ã€‚

### `instructions`ï¼ˆå¿…éœ€ï¼‰

`create_deep_agent` çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ `instructions`ã€‚
è¿™å°†ä½œä¸ºæ·±åº¦ä»£ç†æç¤ºçš„ä¸€éƒ¨åˆ†ã€‚
è¯·æ³¨æ„ï¼Œè¿˜æœ‰ä¸€ä¸ª[å†…ç½®ç³»ç»Ÿæç¤º](#å†…ç½®æç¤º)ï¼Œæ‰€ä»¥è¿™ä¸æ˜¯ä»£ç†å°†çœ‹åˆ°çš„*å…¨éƒ¨*æç¤ºã€‚

### `subagents`ï¼ˆå¯é€‰ï¼‰

`create_deep_agent` çš„ä»…é™å…³é”®å­—å‚æ•°æ˜¯ `subagents`ã€‚
è¿™å¯ç”¨äºæŒ‡å®šæ­¤æ·±åº¦ä»£ç†å°†è®¿é—®çš„ä»»ä½•è‡ªå®šä¹‰å­ä»£ç†ã€‚
æ‚¨å¯ä»¥åœ¨[è¿™é‡Œ](#å­ä»£ç†)é˜…è¯»æ›´å¤šå…³äºä¸ºä»€ä¹ˆè¦ä½¿ç”¨å­ä»£ç†çš„ä¿¡æ¯ã€‚

`subagents` åº”è¯¥æ˜¯å­—å…¸åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªå­—å…¸éµå¾ªæ­¤æ¶æ„ï¼š

```python
class SubAgent(TypedDict):
    name: str
    description: str
    prompt: str
    tools: NotRequired[list[str]]
```

- **name**: è¿™æ˜¯å­ä»£ç†çš„åç§°ï¼Œä»¥åŠä¸»ä»£ç†å¦‚ä½•è°ƒç”¨å­ä»£ç†
- **description**: è¿™æ˜¯æ˜¾ç¤ºç»™ä¸»ä»£ç†çš„å­ä»£ç†æè¿°
- **prompt**: è¿™æ˜¯ç”¨äºå­ä»£ç†çš„æç¤º
- **tools**: è¿™æ˜¯å­ä»£ç†å¯ä»¥è®¿é—®çš„å·¥å…·åˆ—è¡¨ã€‚é»˜è®¤æƒ…å†µä¸‹å°†å¯ä»¥è®¿é—®æ‰€æœ‰ä¼ å…¥çš„å·¥å…·ä»¥åŠæ‰€æœ‰å†…ç½®å·¥å…·ã€‚

ä½¿ç”¨ç¤ºä¾‹ï¼š

```python
research_sub_agent = {
    "name": "research-agent",
    "description": "ç”¨äºæ›´æ·±å…¥åœ°ç ”ç©¶é—®é¢˜",
    "prompt": sub_research_prompt,
}
subagents = [research_subagent]
agent = create_deep_agent(
    tools,
    prompt,
    subagents=subagents
)
```

### `model`ï¼ˆå¯é€‰ï¼‰

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`deepagents` å°†ä½¿ç”¨ `"claude-sonnet-4-20250514"`ã€‚å¦‚æœæ‚¨æƒ³ä½¿ç”¨ä¸åŒçš„æ¨¡å‹ï¼Œ
å¯ä»¥ä¼ é€’ä¸€ä¸ª [LangChain æ¨¡å‹å¯¹è±¡](https://python.langchain.com/docs/integrations/chat/)ã€‚

## æ·±åº¦ä»£ç†è¯¦æƒ…

ä»¥ä¸‹ç»„ä»¶å†…ç½®äº `deepagents` ä¸­ï¼Œä½¿å…¶èƒ½å¤Ÿå¼€ç®±å³ç”¨åœ°å¤„ç†æ·±åº¦ä»»åŠ¡ã€‚

### ç³»ç»Ÿæç¤º

`deepagents` å¸¦æœ‰[å†…ç½®ç³»ç»Ÿæç¤º](src/deepagents/prompts.py)ã€‚è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹è¯¦ç»†çš„æç¤ºï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸ŠåŸºäºå¹¶å—åˆ°[å°è¯•](https://github.com/kn1026/cc/blob/main/claudecode.md)[å¤åˆ¶](https://github.com/asgeirtj/system_prompts_leaks/blob/main/Anthropic/claude-code.md) Claude Code ç³»ç»Ÿæç¤ºçš„å¯å‘ã€‚å®ƒæ¯” Claude Code çš„ç³»ç»Ÿæç¤ºæ›´åŠ é€šç”¨ã€‚
è¿™åŒ…å«äº†å¦‚ä½•ä½¿ç”¨å†…ç½®è§„åˆ’å·¥å…·ã€æ–‡ä»¶ç³»ç»Ÿå·¥å…·å’Œå­ä»£ç†çš„è¯¦ç»†è¯´æ˜ã€‚
è¯·æ³¨æ„ï¼Œæ­¤ç³»ç»Ÿæç¤ºçš„éƒ¨åˆ†å†…å®¹[å¯ä»¥è‡ªå®šä¹‰](#instructions-å¿…éœ€)ã€‚

å¦‚æœæ²¡æœ‰è¿™ä¸ªé»˜è®¤çš„ç³»ç»Ÿæç¤º - ä»£ç†åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ä¸ä¼šåƒç°åœ¨è¿™æ ·æˆåŠŸã€‚
æç¤ºå¯¹äºåˆ›å»º"æ·±åº¦"ä»£ç†çš„é‡è¦æ€§ä¸å®¹å°è§‘ã€‚

### è§„åˆ’å·¥å…·

`deepagents` å¸¦æœ‰å†…ç½®çš„è§„åˆ’å·¥å…·ã€‚è¿™ä¸ªè§„åˆ’å·¥å…·éå¸¸ç®€å•ï¼ŒåŸºäº ClaudeCode çš„ TodoWrite å·¥å…·ã€‚
è¿™ä¸ªå·¥å…·å®é™…ä¸Šä¸åšä»»ä½•äº‹æƒ… - å®ƒåªæ˜¯ä»£ç†åˆ¶å®šè®¡åˆ’çš„ä¸€ç§æ–¹å¼ï¼Œç„¶åå°†å…¶ä¿å­˜åœ¨ä¸Šä¸‹æ–‡ä¸­ä»¥å¸®åŠ©ä¿æŒæ­£è½¨ã€‚

### æ–‡ä»¶ç³»ç»Ÿå·¥å…·

`deepagents` å¸¦æœ‰å››ä¸ªå†…ç½®çš„æ–‡ä»¶ç³»ç»Ÿå·¥å…·ï¼š`ls`ã€`edit_file`ã€`read_file`ã€`write_file`ã€‚
è¿™äº›å®é™…ä¸Šä¸ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿ - è€Œæ˜¯ä½¿ç”¨ LangGraph çš„ State å¯¹è±¡æ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚
è¿™æ„å‘³ç€æ‚¨å¯ä»¥è½»æ¾åœ°åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œè®¸å¤šè¿™äº›ä»£ç†ï¼Œè€Œä¸å¿…æ‹…å¿ƒå®ƒä»¬ä¼šç¼–è¾‘ç›¸åŒçš„åº•å±‚æ–‡ä»¶ã€‚

ç›®å‰"æ–‡ä»¶ç³»ç»Ÿ"åªæœ‰ä¸€å±‚æ·±åº¦ï¼ˆæ²¡æœ‰å­ç›®å½•ï¼‰ã€‚

è¿™äº›æ–‡ä»¶å¯ä»¥é€šè¿‡ä½¿ç”¨ LangGraph State å¯¹è±¡ä¸­çš„ `files` é”®ä¼ å…¥ï¼ˆä¹Ÿå¯ä»¥æ£€ç´¢ï¼‰ã€‚

```python
agent = create_deep_agent(...)

result = agent.invoke({
    "messages": ...,
    # ä½¿ç”¨æ­¤é”®å°†æ–‡ä»¶ä¼ é€’ç»™ä»£ç†
    # "files": {"foo.txt": "foo", ...}
})

# ä¹‹ååƒè¿™æ ·è®¿é—®ä»»ä½•æ–‡ä»¶
result["files"]
```

### å­ä»£ç†

`deepagents` å†…ç½®äº†è°ƒç”¨å­ä»£ç†çš„èƒ½åŠ›ï¼ˆåŸºäº Claude Codeï¼‰ã€‚
å®ƒå§‹ç»ˆå¯ä»¥è®¿é—® `general-purpose` å­ä»£ç† - è¿™æ˜¯ä¸€ä¸ªå…·æœ‰ä¸ä¸»ä»£ç†ç›¸åŒæŒ‡ä»¤å’Œå®ƒå¯ä»¥è®¿é—®çš„æ‰€æœ‰å·¥å…·çš„å­ä»£ç†ã€‚
æ‚¨è¿˜å¯ä»¥æŒ‡å®š[è‡ªå®šä¹‰å­ä»£ç†](#subagents-å¯é€‰)ï¼Œå…·æœ‰è‡ªå·±çš„æŒ‡ä»¤å’Œå·¥å…·ã€‚

å­ä»£ç†å¯¹äº["ä¸Šä¸‹æ–‡éš”ç¦»"](https://www.dbreunig.com/2025/06/26/how-to-fix-your-context.html#context-quarantine)ï¼ˆå¸®åŠ©ä¸æ±¡æŸ“ä¸»ä»£ç†çš„æ•´ä½“ä¸Šä¸‹æ–‡ï¼‰ä»¥åŠè‡ªå®šä¹‰æŒ‡ä»¤å¾ˆæœ‰ç”¨ã€‚

## è·¯çº¿å›¾
[] å…è®¸ç”¨æˆ·è‡ªå®šä¹‰å®Œæ•´çš„ç³»ç»Ÿæç¤º
[] ä»£ç æ•´æ´æ€§ï¼ˆç±»å‹æç¤ºã€æ–‡æ¡£å­—ç¬¦ä¸²ã€æ ¼å¼åŒ–ï¼‰
[] å…è®¸æ›´å¥å£®çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ
[] åˆ›å»ºåŸºäºæ­¤æ„å»ºçš„æ·±åº¦ç¼–ç ä»£ç†ç¤ºä¾‹
[] å¯¹[æ·±åº¦ç ”ç©¶ä»£ç†](examples/research/research_agent.py)ç¤ºä¾‹è¿›è¡ŒåŸºå‡†æµ‹è¯•
[] ä¸ºå·¥å…·æ·»åŠ äººæœºåä½œæ”¯æŒ
